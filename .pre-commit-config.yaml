repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.5.6
    hooks:
      - id: ruff
        args: ["--fix"]
      - id: ruff-format
  # Temporarily disabled mypy hook (Phase 0). Reason: excessive legacy noise blocks commits.
  # A phased plan to re-enable with narrowed scope will live in docs/mypy_remediation_plan.md.
  # - Phase 1: Restore hook for curated allowlist of stabilized modules.
  # - Phase 2: Gradually expand & remove global ignore_missing_imports.
  # - Phase 3: Enforce full strict gate.
  # - Phase 4: Optional: introduce snapshot guard + error-code budgeting.
  # Previous configuration preserved below for reference.
  # Phase 1 reinstated narrow mypy hook (allowlist). Limit to crew orchestrator while
  # stub packages & targeted overrides are introduced. Expand list in subsequent phases.
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.10.0
    hooks:
      - id: mypy
        name: "mypy (allowlist: crew.py, profiles/schema.py, services/prompt_engine.py, services/memory_service.py, core/flags.py)"
        additional_dependencies:
          - types-PyYAML
          - types-requests
        # Use explicit target path and prevent import graph expansion to keep Phase 1 narrow.
        args:
          [
            "--config-file",
            "pyproject.toml",
            "--follow-imports=skip",
            "--no-error-summary",
            "src/ultimate_discord_intelligence_bot/crew.py",
            "src/ultimate_discord_intelligence_bot/profiles/schema.py",
            "src/ultimate_discord_intelligence_bot/services/prompt_engine.py",
            "src/ultimate_discord_intelligence_bot/services/memory_service.py",
            "src/core/flags.py",
          ]
        pass_filenames: false
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: check-yaml
      - id: check-toml
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: mixed-line-ending
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.18.4
    hooks:
      - id: gitleaks
        name: gitleaks (secret scan)
        args: ["detect", "--no-color", "--redact", "--config=.gitleaks.toml"]
        stages: [commit, push]
  - repo: local
    hooks:
      - id: validate-dispatcher-usage
        name: Validate no direct yt-dlp usage outside wrappers
        entry: scripts/validate_dispatcher_usage.py
        language: python
        types: [python]
        files: ^src/.*\.py$
      - id: validate-http-wrappers-usage
        name: Validate no direct 'requests' usage outside http_utils
        entry: scripts/validate_http_wrappers_usage.py
        language: python
        types: [python]
        files: ^src/.*\.py$
