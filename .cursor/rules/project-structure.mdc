---
alwaysApply: true
description: Project structure and key file index
---
### Project Structure Overview

- Entry: [main.py](mdc:src/app/main.py)
- Crew: [crew_executor.py](mdc:src/app/crew_executor.py)
- Agents: [config/agents.yaml](mdc:src/app/config/agents.yaml)
- Tasks: [config/tasks.yaml](mdc:src/app/config/tasks.yaml)
- Tools: [tools/](mdc:src/ultimate_discord_intelligence_bot/tools/) and domain-specific tools
- Platform: [platform/](mdc:src/platform/) - Infrastructure (HTTP, cache, observability, RL, LLM)
- Domains: [domains/](mdc:src/domains/) - Business logic (intelligence, ingestion, memory, orchestration)
- App: [app/](mdc:src/app/) - Application layer (Discord bot, API)
- Settings: [config/settings.py](mdc:src/app/config/settings.py)
- Pipeline: [domains/ingestion/pipeline/](mdc:src/domains/ingestion/pipeline/)
- Tenancy: [tenancy/context.py](mdc:src/app/tenancy/context.py)
- Docs: [docs/](mdc:docs/)
- Top-level: [README.md](mdc:README.md), [pyproject.toml](mdc:pyproject.toml), [requirements.lock](mdc:requirements.lock)

### Conventions

- Python 3.10+, line length 120, double quotes
- Import order: stdlib → third-party → local
- UTC timestamps only

---

alwaysApply: false
description: Project structure and organization overview for the Ultimate Discord Intelligence Bot
---

# Ultimate Discord Intelligence Bot - Project Structure

## Core Architecture

The main entry point is [main.py](mdc:src/app/main.py), which orchestrates the CrewAI-based debate analysis system. Configuration is managed through [pyproject.toml](mdc:pyproject.toml) and YAML files in the [app/config/](mdc:src/app/config/) directory.

The repository uses a **3-layer architecture**:
- **Platform** (`src/platform/`) - Infrastructure (HTTP, cache, observability, RL, LLM)
- **Domains** (`src/domains/`) - Business logic (intelligence, ingestion, memory, orchestration)
- **App** (`src/app/`) - Application layer (Discord bot, API)

## Directory Structure

```
ultimate-discord-intelligence-bot/
├── src/
│   ├── platform/                           # Infrastructure layer
│   │   ├── core/                           # Core utilities (step_result, etc.)
│   │   ├── http/                           # HTTP client, retries, circuit breakers
│   │   ├── cache/                           # Multi-level caching
│   │   ├── observability/                  # Metrics, tracing, logging
│   │   ├── security/                       # Auth, secrets, rate limiting
│   │   ├── llm/                            # LLM abstractions (providers, routing, structured)
│   │   ├── rl/                             # Reinforcement learning policies
│   │   ├── prompts/                        # Prompt engineering (engine, dspy)
│   │   ├── config/                         # Configuration management
│   │   └── ...
│   ├── domains/                            # Business logic layer
│   │   ├── intelligence/                   # Content analysis and insights
│   │   │   ├── analysis/                  # Debate scoring, sentiment, safety
│   │   │   └── verification/              # Fact-checking, claim verification
│   │   ├── ingestion/                      # Multi-platform content acquisition
│   │   │   ├── providers/                 # YouTube, TikTok, Twitter, Reddit
│   │   │   └── pipeline/                  # Ingestion orchestration
│   │   ├── memory/                         # Knowledge storage and retrieval
│   │   │   ├── vector/                    # Qdrant, embeddings, hybrid search
│   │   │   ├── graph/                      # Neo4j knowledge graphs
│   │   │   └── continual/                 # HippoRAG, Mem0, continual learning
│   │   └── orchestration/                  # Agent and workflow management
│   │       └── crewai/                    # CrewAI core integration
│   ├── app/                                # Application layer
│   │   ├── discord/                        # Discord.py integration
│   │   │   ├── bot.py                      # Bot instance
│   │   │   ├── commands/                   # Command handlers
│   │   │   └── events/                     # Event handlers
│   │   ├── config/                         # App-level configuration
│   │   │   ├── agents.yaml                 # Agent definitions
│   │   │   ├── tasks.yaml                  # Task definitions
│   │   │   └── settings.py                 # App settings
│   │   ├── crew_executor.py                # CrewAI execution wrapper
│   │   └── main.py                         # Application entry point
│   ├── ultimate_discord_intelligence_bot/   # Legacy compatibility layer
│   │   └── tools/                          # Tool registry (backward compatibility)
│   ├── mcp_server/                         # Model Context Protocol servers
│   ├── eval/                               # Evaluation harness
│   ├── graphs/                             # LangGraph implementations
│   └── scripts/                             # Utility scripts
├── config/                                 # Global configs
├── tests/                                  # Test suite
│   ├── conftest.py                         # Test fixtures
│   ├── test_tools/
│   ├── test_services/
│   └── ...
├── docs/                                   # Documentation
│   ├── agents/
│   ├── architecture/
│   ├── configuration.md
│   ├── tools_reference.md
│   └── ...
├── docker/                                 # Docker configs
├── .env.example                            # Environment template
├── pyproject.toml                          # Project config
├── Makefile                                # Development commands
└── docker-compose.yml                      # Service orchestration
```

## Key Components

### Application Core

- **[main.py](mdc:src/app/main.py)**: Orchestrates the crew execution
- **[crew_executor.py](mdc:src/app/crew_executor.py)**: CrewAI execution wrapper
- **[config/settings.py](mdc:src/app/config/settings.py)**: Centralized configuration management
- **[platform/core/step_result.py](mdc:src/platform/core/step_result.py)**: Standardized return format

### CrewAI Configuration

- **[app/config/agents.yaml](mdc:src/app/config/agents.yaml)**: Agent definitions with roles and goals
- **[app/config/tasks.yaml](mdc:src/app/config/tasks.yaml)**: Task definitions and dependencies

### Platform Layer

- **platform/http/**: HTTP client, retries, circuit breakers
- **platform/cache/**: Multi-level caching (Redis, semantic, LRU)
- **platform/observability/**: Metrics, tracing, logging
- **platform/llm/**: LLM abstractions (providers, routing, structured)
- **platform/rl/**: Reinforcement learning policies

### Domain Layer

- **domains/intelligence/**: Content analysis and insights
- **domains/ingestion/**: Multi-platform content acquisition
- **domains/memory/**: Knowledge storage and retrieval
- **domains/orchestration/**: Agent and workflow management

### Tools & Services

- **ultimate_discord_intelligence_bot/tools/**: Tool registry (backward compatibility)
- **domains/*/tools/**: Domain-specific tools
- **platform/prompts/engine/**: Prompt engine
- **domains/memory/**: Memory services

### Content Pipeline

```
Multi-Platform Sources → Ingestion → Transcription → Analysis → Memory Storage → Discord Output
```

### Testing Infrastructure

- **[tests/conftest.py](mdc:tests/conftest.py)**: Shared test fixtures and mocks
- Unit tests mirror source structure
- Integration tests for end-to-end workflows

## Development Standards

### Code Organization

- One class/tool per file
- Clear separation of concerns
- Dependency injection for services
- Tenant-aware design throughout

### Import Order

```python
# Standard library
import os
import sys
from typing import Optional

# Third-party
import discord
from crewai import Agent, Task

# Local application
from ultimate_discord_intelligence_bot.step_result import StepResult
from ultimate_discord_intelligence_bot.tools import DebateAnalysisTool
```

### Module Responsibilities

#### Tools (`tools/`)

- Implement CrewAI BaseTool
- Handle specific operations
- Return StepResult objects
- Include input validation

#### Services (`services/`)

- Provide shared functionality
- Manage external integrations
- Handle caching and optimization
- Abstract complex operations

#### Ingest (`ingest/`)

- Platform-specific downloaders
- Content extraction
- Metadata parsing
- Format normalization

#### Analysis (`analysis/`)

- Debate scoring algorithms
- Fact-checking logic
- Bias detection
- Summarization

#### Memory (`memory/`)

- Vector storage operations
- Embedding generation
- Semantic search
- Knowledge graph management

#### Discord (`discord/`)

- Bot commands
- Event handlers
- Message formatting
- Rate limiting

## Configuration Files

### Environment Variables (`.env`)

```bash
# Required
DISCORD_BOT_TOKEN=
OPENAI_API_KEY=      # or OPENROUTER_API_KEY
QDRANT_URL=

# Optional
ENABLE_DEBATE_ANALYSIS=true
ENABLE_FACT_CHECKING=true
LOG_LEVEL=INFO
```

### Project Configuration (`pyproject.toml`)

- Package metadata
- Dependencies
- Development tools
- Build configuration

### Docker Services (`docker-compose.yml`)

- Qdrant vector database
- Discord bot service
- Monitoring stack (optional)

## Documentation Structure

- **[docs/agents/](mdc:docs/agents/)**: Agent documentation and guidelines
- **[docs/architecture/](mdc:docs/architecture/)**: System design and patterns
- **[docs/configuration.md](mdc:docs/configuration.md)**: Configuration reference
- **[docs/tools_reference.md](mdc:docs/tools_reference.md)**: Tool documentation
- **[docs/operations/](mdc:docs/operations/)**: Deployment and operations
